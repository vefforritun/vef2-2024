---
title: React events & state
---

## React events & state

### Vefforritun

### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## Atbur√∞ir √≠ React

* Atbur√∞ir √≠ React svipa til DOM atbur√∞a og nota √æ√° ‚Äûundir h√∫ddinu‚Äú
* Festum _beint √° element_ √≠ JSX üôÄ
  * Eitthva√∞ sem vi√∞ l√¶r√∞um √≠ vefforritun 1 a√∞ gera **alls ekki**
* camelCase og f√∂ll en ekki strengir
  * `<button onClick={activateLasers}>` ekki `<button onclick="activateLasers()">`

***

<!-- eslint-disable no-unused-vars, no-undef, react/react-in-jsx-scope, constructor-super , no-this-before-super, import/no-extraneous-dependencies, import/no-unresolved, react/prop-types, react/jsx-no-undef, implicit-arrow-linebreak, react/jsx-key -->

```javascript
function ActionLink() {
  function handleClick(e) {
    e.preventDefault();
    console.log('The link was clicked.');
  }

  return (
    <a href="#" onClick={handleClick}>
      Click me
    </a>
  );
}
```

***

## A√∞ taka √æ√°tt √≠ atbur√∞um

* √ç react √æurfum vi√∞ yfirleitt ekki a√∞ nota `addEventListener`
* React notar _synthetic events_, ekki _alv√∂ru_ event fr√° browser
* Skr√°um handler beint √≠ JSX og react s√©r um

***

## Synthetic event

* React √∫tf√¶rir eigin events √∫t fr√° W3C spec
  * Getum nota√∞ `e.stopPropagation()` og `e.preventDefault()`
* Endurn√Ωtir events og gerir √Ωmislegt til a√∞ f√° betra performance
* [React: SyntheticEvent](https://reactjs.org/docs/events.html)

***

## Binding

* √ûa√∞ er algengt a√∞ nota class method √æegar vi√∞ skr√°um handler √° class
* Ver√∞um a√∞ passa a√∞ _binda_ r√©tt til √æess a√∞ `this` virki
* Nokkrar lei√∞ir √≠ bo√∞i

***

## Binding lei√∞ir

* Binda √≠ `constructor`
  * `this.handleClick = this.handleClick.bind(this);`
  * Frekar fyrirfer√∞armiki√∞

***

* Binda √≠ event
  * `<button onClick={(e) => this.handleClick(e)}>`
  * Getur or√∞i√∞ fyrirfer√∞armiki√∞ og fl√≥ki√∞ a√∞ lesa
  * Veldur √æv√≠ a√∞ fyrir hvert `render` er b√∫i√∞ til n√Ωtt fall

***

* Nota public class field (ekki or√∞i√∞ sta√∞la√∞)
  *`handleClick = () => { /* ... */ }`
  * √û√¶gileg lei√∞ sem er studd af CRA
  * M√¶li me√∞ a√∞ nota √æessa

***

<!-- eslint-disable no-unused-vars, no-undef, react/react-in-jsx-scope, constructor-super , no-this-before-super, import/no-extraneous-dependencies, import/no-unresolved, react/prop-types, react/jsx-no-undef, implicit-arrow-linebreak, react/jsx-key -->

```javascript
class MyComponent extends Component {
  handleClick(e) {
    console.log(this, e);
  }

  render() {
    return (
      <p>
        <button onClick={this.handleClick}>
          click
        </button>
      </p>
    );
  }
}
```

***

## Binding √≠ functional components

* √ûurfum ekki a√∞ p√¶la √≠ binding √≠ functional components
* B√∫um til lokun (closure) yfir component sem geymir v√≠sun √≠ skilgreind f√∂ll

***

<!-- eslint-disable no-unused-vars, no-undef, react/react-in-jsx-scope, constructor-super , no-this-before-super, import/no-extraneous-dependencies, import/no-unresolved, react/prop-types, react/jsx-no-undef, implicit-arrow-linebreak, react/jsx-key -->

```javascript
function MyComponent() {
  const handleClick = (e) => {
    console.log(e);
  };

  // e√∞a
  function handleClickk(e) {
    console.log(e);
  }

  return (
    <p>
      <button onClick={this.handleClick}>
        click
      </button>
    </p>
  );
}
```

---

## Argument √≠ event handler

* Til a√∞ senda g√∂gn √≠ event handler getum vi√∞ nota√∞
  * `<button onClick={(e) => this.del(id, e)}>Delete</button>`
  * `<button onClick={this.del.bind(this, id)}>Delete</button>`

***

* E√∞a vi√∞ getum √∫tb√∫i√∞ handler sem skilar _√∂√∞rum_ handler

***

<!-- eslint-disable no-unused-vars, no-undef, react/react-in-jsx-scope, constructor-super , no-this-before-super, import/no-extraneous-dependencies, import/no-unresolved, react/prop-types, react/jsx-no-undef, implicit-arrow-linebreak, react/jsx-key -->

```javascript
const deleteThing = (id) => (e) => {
  e.preventDefault();
  // Lokun (closure) yfir id
  // id er a√∞gengilegt √æegar
  // atbur√∞ur √° s√©r sta√∞
};

// ...

const button = (<button onClick={this.deleteThing(1)} />);
```

---

## State

* Sta√∞a fyrir component, a√∞eins s√Ωnileg innan component
* Svipar til `props` en er ekki read-only og breytist me√∞ notkun √° component
* Stj√≥rna√∞ af component a√∞ √∂llu leiti
* Til fyrir class component og functional components
* √Üttum a√∞eins a√∞ setja hluti sem ver√∞a birtir √≠ `state`, √æ.e.a.s. part af vi√∞m√≥ti

***

## D√¶mi um state

* Er b√∫i√∞ a√∞ smella √° takka sem s√Ωnir auka uppl√Ωsingar?
* Er veri√∞ a√∞ s√¶kja g√∂gn?
* Hva√∞a g√∂gn er b√∫i√∞ a√∞ s√¶kja og birta?
* Hva√∞ er b√∫i√∞ a√∞ skrifa inn √≠ `<input>`?

---

# State √≠ class components

***

## Byrjunarsta√∞a

* Setjum `this.state = { ... }` √≠ `contstructor`
* Ef vi√∞ h√∂fum stu√∞ning vi√∞ member breytur sem `state = { ... }` √≠ class (virkar √≠ CRA)
* **Eina skipti√∞** sem vi√∞ setjum `state` beint

***

<!-- eslint-disable no-unused-vars, no-undef, react/react-in-jsx-scope, constructor-super , no-this-before-super, import/no-extraneous-dependencies, import/no-unresolved, react/prop-types, react/jsx-no-undef, implicit-arrow-linebreak, react/jsx-key -->

```javascript
class MyComponent extends Component {
  constructor(props) {
    super(props);
    this.state = { /* ... */ };
  }
}
```

```text
class MyComponent extends Component {
  // Stu√∞ningur vi√∞ member breytu
  state = { /* ... */ };
}
```

***

## Uppf√¶rsla √° `state` √≠ class compoment

* Uppf√¶rsla √° `state` fer alltaf fram √≠ gegnum `this.setState()`
* Uppf√¶rslur eru keyr√∞ar asynchronously, getum ekki treyst √° a√∞ uppf√¶rsla hafi √°tt s√©r sta√∞ √≠ n√¶stu l√≠nu

***

* Ef vi√∞ viljum b√≠√∞a eftir a√∞ b√∫i√∞ s√© a√∞ setja `state` getum vi√∞ nota√∞ `this.setState((prevState, props) => { /* ... */ })`
* Getum uppf√¶rt einn hlut √≠ st√∂√∞u √≠ einu, √æurfum ekki a√∞ uppf√¶ra allt √≠ einu

***

```javascript
// üëéüèº
this.state.comment = 'Hello';
```

```javascript
// üëçüèº
this.setState({ comment: 'Hello' });
```

***

```javascript
// üëéüèº
this.setState({
  counter:
    this.state.counter + this.props.incr,
});
```

```javascript
// üëçüèº
this.setState((prevState, props) => ({
  counter: prevState.counter + props.incr,
}));
```

---

## State √≠ functional components

* N√Ωlega (fr√° React 16.8, 2019) h√¶gt a√∞ skilgreina state og a√∞ra virkni √°n √æess a√∞ nota class components me√∞ _hooks_
* Kemur ekki √≠ sta√∞inn fyrir classes
* Getur stytt k√≥√∞a t√∂luvert og gert (oftast!) l√¶silegri

***

* Leyfa okkur a√∞ ‚Äûhooka‚Äú okkur inn √≠ React state og lifecycle methods fr√° functional componentum
* React skilgreinir fyrir grunna√∞ger√∞ir og a√∞rar sem geta veri√∞ nytsamlegar
* [N√°nar um hooks](https://reactjs.org/docs/hooks-intro.html)
  * [Using the State Hook](https://reactjs.org/docs/hooks-state.html)

***

## Hooks reglur

Ver√∞um a√∞ fylgja [relgum um hooks](https://reactjs.org/docs/hooks-rules.html), lendum annars √≠ vandr√¶√∞um, a√∞allega:

* A√∞eins kalla √≠ hooks yst √≠ falli
  *Ekki √≠ lykkjum, fl√¶√∞ist√Ωringum e√∞a innrif√∂llum
* A√∞eins kalla √≠ hooks √∫r React componentum
  *Ekki √∫r ‚Äûvenjulegum‚Äú JavaScript f√∂llum

***

## useState

* `useState` leyfir okkur a√∞ nota state √≠ functional components
* √Å√∞ur √æurftum vi√∞ a√∞ breyta √æeim √≠ class component
  *_Mikill_ auka k√≥√∞i
* Skilar tvennd √≠ fylki: fyrra er gildi√∞, seinna er fall til a√∞ breyta gildi

***

* Sendum inn upphafsgildi √æegar vi√∞ skilgreinum state fyrst
* `const [count, setCount] = useState(0);`
  *Notar _array destructuring_
* Getum skilgreint eins m√∂rg `useState` og vi√∞ √æurfum √≠ component

***

<!-- eslint-disable no-unused-vars, no-undef, react/react-in-jsx-scope, constructor-super , no-this-before-super, import/no-extraneous-dependencies, import/no-unresolved, react/prop-types, react/jsx-no-undef, implicit-arrow-linebreak, react/jsx-key -->

```javascript
import React, { useState } from 'react';

function Example() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>You clicked {count} times</p>
      <button
        onClick={() => setCount(count + 1)}
      >
        Click me
      </button>
    </div>
  );
}
```

---

## Fl√¶√∞i gagna

* Componentum √° a√∞ vera alveg sama hvort a√∞rir componentar hafi st√∂√∞u e√∞a ekki; s√©u functional e√∞a ekki
* `state` er h√°√∞ √∫tf√¶rslu component og er aldrei a√∞gengilegt √∂√∞rum componentum
  *Nema component sendi part af st√∂√∞u √°fram √≠ _prop_ hj√° √∂√∞rum component

***

## G√∂gn fl√¶√∞a ni√∞ur

* G√∂gn √≠ react fl√¶√∞a alltaf _ni√∞ur_
  *_top-down_ e√∞a _unidirectional_ gagnafl√¶√∞i
* √ûetta vefst fyrir m√∂rgum sem byrja a√∞ nota react
* Vegna reconciliation √∫tf√¶rslu er √≥d√Ωrar fyrir okkur a√∞ teikna **allt** UI aftur en a√∞ breyta √°kve√∞num hlut
  * Eigum aldrei (mj√∂g sjaldan!) a√∞ √æurfa a√∞ nota sj√°lf DOM a√∞ger√∞ir
* Sko√∞um n√°nar √≠ n√¶sta fyrirlestri
